items
length(items)
length(regions)
dim(borders)
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
reg_data <- lapply(reg_data, function(r) {cnames <- colnames(r);rnames <- rownames(r)
temp <- lapply(1:ncol(r), function(c) cbind(items[items!=""],cnames,r[,c]))
temp <- do.call(rbind,temp)})
reg_data
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
reg_data <- lapply(reg_data, function(r) {cnames <- colnames(r);rnames <- rownames(r)
temp <- lapply(1:ncol(r), function(c) cbind(items[items!=""],cnames,r[,c]))
temp <- do.call(rbind,temp)})
warnings()
items
aa <- items[items!=""]
aa
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
length(reg_data)
reg_data[[1]]
dim(reg_data[[1]])
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
reg_data <- lapply(reg_data, function(r) {cnames <- colnames(r);rnames <- rownames(r)
temp <- lapply(1:ncol(r), function(c) cbind(rnames,cnames,r[,c]))
temp <- do.call(rbind,temp)})
reg_data
reg_data <- lapply(reg_data, function(r) {cnames <- colnames(r);rnames <- rownames(r)
temp <- lapply(1:ncol(r), function(c) cbind(rnames,cnames,r[,c]))
temp <- do.call(rbind,temp)})
reg_data[[1]]
reg_data[[1]]
rownames(reg_data[[1]])
as.numaric(rownames(reg_data[[1]]))
as.numeric(rownames(reg_data[[1]]))
aa <- as.numeric(rownames(reg_data[[1]]))
years
reg_data
reg_data[[1]]
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
reg_data <- lapply(reg_data, function(r) {cnames <- colnames(r);rnames <- rownames(r)
temp <- lapply(1:ncol(r), function(c) cbind(rnames,cnames,r[,c]))
temp <- do.call(rbind,temp)})
reg_data
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
reg_data <- lapply(reg_data, function(r) {cnames <- colnames(r);rnames <- rownames(r)
temp <- lapply(1:ncol(r), function(c) cbind(rnames,cnames,r[,c]))})
reg_data
borders <- cbind(which(regions!=""), c((which(regions!="")-1)[-1],length(regions)))
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
reg_data
reg_data[[1]]
aa <- matrix(1:25,5)
aa
c(aa)
reg_data[[1]]
t(reg_data[[1]])
c(t(reg_data[[1]]))
t(reg_data[[1]])
colnames(reg_data)
colnames(reg_data[[1]])
sapply(rownames(reg_data[[1]], function(r) sapply(colnames(reg_data[[1]]), function(c) paste0(r,"-",c))
reg_data[[1]]
sapply(rownames(reg_data[[1]], function(r) sapply(colnames(reg_data[[1]]), function(c) paste0(r,"-",c)))
reg_data[[1]]
sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]]), function(c) paste0(r,"-",c)))
reg_data[[1]]
dat <- read.csv(paste0(datafolder,datalist[1]),sep="|")
dat <- dat[-3,-1]
regions <- sapply(dat[1,], as.character); names(regions) <- c(); regions <- regions[-(1:2)]
months  <- sapply(dat[2,], as.character); names(months) <- c(); months <- months[-(1:2)]
items   <- sapply(dat[,1], as.character); names(items) <- c()
items
years   <- dat[-c(1:2),2]
data    <- dat[-(1:2),-c(1:2)]; data <- data[!is.na(years),!is.na(months)]
data    <- as.matrix(data)
data
rownames(data) <- years[!is.na(years)]
colnames(data) <- months[!is.na(months)]
data
dim(data)
length(items)
head(items)
items   <- sapply(dat[,1], as.character); names(items) <- c(); items <- items[-(1:2)]
items
length(items)
!is.na(years)
items <- items[!is.na(years)]
items
items
dim(data)
length(data)
length(items)
cbind(items,data)
items
items==""
items!=""
which(items!="")
borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
borders
<-
items
items    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; items[b[1]:b[2]]})
items
lapply(items, function(i) rep(i[1], length(i))
cbind(items,data)
regions <- regions[!is.na(months)]
borders <- cbind(which(regions!=""), c((which(regions!="")-1)[-1],length(regions)))
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
# reg_data <- lapply(reg_data, function(r) {cnames <- colnames(r);rnames <- rownames(r)
# temp <- lapply(1:ncol(r), function(c) cbind(rnames,cnames,r[,c]))})
# temp <- do.call(rbind,temp)})
c(t(reg_data[[1]]))
sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]]), function(c) paste0(r,"-",c)))
reg_data[[1]]
lapply(items, function(i) rep(i[1], length(i)))
unlist(lapply(items, function(i) rep(i[1], length(i))))
items    <- unlist(lapply(items, function(i) rep(i[1], length(i))))
data     <- cbind(items,data)
data
regions <- regions[!is.na(months)]
regions
borders <- cbind(which(regions!=""), c((which(regions!="")-1)[-1],length(regions)))
borders
reg_data    <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
reg_data
reg_data[[1]]
data
regions
borders
reg_data
names(reg_data) <- regions[regions!=""]
reg_data
reg_data
sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]]), function(c) paste0(r,"-",c)))
c(t(reg_data[[1]]))
c(t(reg_data[[1]][,-1]))
sapply(rownames(reg_data[[1]][-1]), function(r) sapply(colnames(reg_data[[1]][-1]), function(c) paste0(r,"-",c)))
colnames(reg_data[[1]])
rownames(reg_data[[1]])
sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]][-1]), function(c) paste0(r,"-",c)))
sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]][,-1]), function(c) paste0(r,"-",c)))
t(sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]][,-1]), function(c) paste0(r,"-",c))))
c(t(sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]][,-1]), function(c) paste0(r,"-",c)))))
c(sapply(rownames(reg_data[[1]]), function(r) sapply(colnames(reg_data[[1]][,-1]), function(c) paste0(r,"-",c))))
c(t(reg_data[[1]][,-1]))
c(t(reg_data[[1]][,-1]))
c(t(reg_data[[1]][,-1]))
c(t(reg_data[[1]][,-1]))
reg_data[[1]]
items
reg_data
reg_data[[1]]
reg_data[[1]]
reg_data[[1]][,1]
!duplicated(reg_data[[1]][,1])
aa <- !duplicated(reg_data[[1]][,1])
aa
which(aa)
items
dat <- read.csv(paste0(datafolder,datalist[1]),sep="|")
dat <- dat[-3,-1]
regions <- sapply(dat[1,], as.character); names(regions) <- c(); regions <- regions[-(1:2)]
months  <- sapply(dat[2,], as.character); names(months) <- c(); months <- months[-(1:2)]
items   <- sapply(dat[,1], as.character); names(items) <- c(); items <- items[-(1:2)]
years   <- dat[-c(1:2),2]
data    <- dat[-(1:2),-c(1:2)]; data <- data[!is.na(years),!is.na(months)]
data    <- as.matrix(data)
rownames(data) <- years[!is.na(years)]
colnames(data) <- months[!is.na(months)]
items   <- items[!is.na(years)]
item_borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
item_borders
items   <- lapply(1:nrow(item_borders), function(r) {b <- borders[r,]; items[b[1]:b[2]]})
items   <- unlist(lapply(items, function(i) rep(i[1], length(i))))
data    <- cbind(items,data)
dat <- read.csv(paste0(datafolder,datalist[1]),sep="|")
dat <- dat[-3,-1]
regions <- sapply(dat[1,], as.character); names(regions) <- c(); regions <- regions[-(1:2)]
months  <- sapply(dat[2,], as.character); names(months) <- c(); months <- months[-(1:2)]
items   <- sapply(dat[,1], as.character); names(items) <- c(); items <- items[-(1:2)]
years   <- dat[-c(1:2),2]
data    <- dat[-(1:2),-c(1:2)]; data <- data[!is.na(years),!is.na(months)]
data    <- as.matrix(data)
rownames(data) <- years[!is.na(years)]
colnames(data) <- months[!is.na(months)]
items   <- items[!is.na(years)]
item_borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
items   <- lapply(1:nrow(item_borders), function(r) {b <- item_borders[r,]; items[b[1]:b[2]]})
items   <- unlist(lapply(items, function(i) rep(i[1], length(i))))
data    <- cbind(items,data)
data
regions <- regions[!is.na(months)]
borders <- cbind(which(regions!=""), c((which(regions!="")-1)[-1],length(regions)))
reg_data  <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
dat <- read.csv(paste0(datafolder,datalist[1]),sep="|")
dat <- dat[-3,-1]
regions <- sapply(dat[1,], as.character); names(regions) <- c(); regions <- regions[-(1:2)]
months  <- sapply(dat[2,], as.character); names(months) <- c(); months <- months[-(1:2)]
items   <- sapply(dat[,1], as.character); names(items) <- c(); items <- items[-(1:2)]
years   <- dat[-c(1:2),2]
data    <- dat[-(1:2),-c(1:2)]; data <- data[!is.na(years),!is.na(months)]
data    <- as.matrix(data)
rownames(data) <- years[!is.na(years)]
colnames(data) <- months[!is.na(months)]
items   <- items[!is.na(years)]
item_borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
regions <- regions[!is.na(months)]
regions
borders <- cbind(which(regions!=""), c((which(regions!="")-1)[-1],length(regions)))
borders
reg_data  <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
item_borders
item_borders
items   <- lapply(1:nrow(item_borders), function(r) {b <- item_borders[r,]; items[b[1]:b[2]]})
items
dim(reg_data)
dim(reg_data[[1]])
dim(reg_data[[2]])
dim(reg_data[[3]])
item_borders
items
item_borders
reg_data[[1]]
lapply(1:nrow(item_borders), function(r) {b <- reg_data[[1]][r,]; reg_data[[1]][b[1]:b[2]]})
lapply(1:nrow(item_borders), function(r) {b <- reg_data[[1]][r,]; reg_data[[1]][b[1]:b[2],]})
reg_data
reg_data[[1]]
lapply(1:nrow(item_borders), function(r) {b <- item_borders[[1]][r,]; reg_data[[1]][b[1]:b[2],]})
item_borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
item_borders
items   <- items[!is.na(years)]
item_borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
item_borders
lapply(1:nrow(item_borders), function(r) {b <- item_borders[[1]][r,]; reg_data[[1]][b[1]:b[2],]})
lapply(1:nrow(item_borders), function(r) {b <- item_borders[r,]; reg_data[[1]][b[1]:b[2],]})
item_borders
[b[1]:b[2],]
b[1]
1:nrow(item_borders)
item_borders
dat <- read.csv(paste0(datafolder,datalist[1]),sep="|")
dat <- dat[-3,-1]
regions <- sapply(dat[1,], as.character); names(regions) <- c(); regions <- regions[-(1:2)]
months  <- sapply(dat[2,], as.character); names(months) <- c(); months <- months[-(1:2)]
items   <- sapply(dat[,1], as.character); names(items) <- c(); items <- items[-(1:2)]
years   <- dat[-c(1:2),2]
data    <- dat[-(1:2),-c(1:2)]; data <- data[!is.na(years),!is.na(months)]
data    <- as.matrix(data)
rownames(data) <- years[!is.na(years)]
colnames(data) <- months[!is.na(months)]
items   <- items[!is.na(years)]
item_borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
item_borders
regions <- regions[!is.na(months)]
borders <- cbind(which(regions!=""), c((which(regions!="")-1)[-1],length(regions)))
reg_data  <- lapply(1:nrow(borders), function(r) {b <- borders[r,]; data[,b[1]:b[2]]})
names(reg_data) <- regions[regions!=""]
item_borders <- cbind(which(items!=""), c((which(items!="")-1)[-1],length(items)))
item_borders
lapply(1:nrow(item_borders), function(r) {b <- item_borders[r,]; reg_data[[1]][b[1]:b[2],]})
lapply(1:nrow(item_borders), function(r) {b <- item_borders[r,]; reg_data[[1]][b[1]:b[2],]})
regdat <- lapply(1:nrow(item_borders), function(r) {b <- item_borders[r,]; reg_data[[1]][b[1]:b[2],]})
regdat
regdat
colnames(regdat)
regdats <- lapply(1:nrow(item_borders), function(r) {b <- item_borders[r,]; reg_data[[1]][b[1]:b[2],]})
lapply(regdats, function(regdat) sapply(rownames(regdat), function(r) sapply(colnames(regdat), function(c) paste0(r,"-",c))))
cnames  <- lapply(regdats, function(regdat) c(sapply(rownames(regdat), function(r) sapply(colnames(regdat), function(c) paste0(r,"-",c)))))
cnames
regdats <- lapply(regdats, function(regdat) c(t(regdat)))
regdats
regdats[[1]]
cnames
length(cnames)
lapply(cnames,length)
sapply(cnames,length)
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)
sapply(cnames,length)/12
sapply(cnames,length)
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
sapply(cnames,length)/12
cnames[[1]]
save(cnames[[1]],file = "dates.rda")
save(cnames,file = "dates.rda")
out
dates <- save(cnames, file = "dates.rda")
dates
dates <- cnames[[1]]
dates
regdats
install.packages("Rserve")
q()
install.packages("ggplot2")
install.packages("quanteda")
install.packages("XML")
install.packages("XML")
library("XML")
install.packages("quanteda")
install.packages("rmongo")
install.packages("RMongo")
install.packages("RMongo")
q()
q()
shiny::runApp('Downloads/sample')
Tm=75;n=10;clsize=5; frho=.6; ind=1
library("stringr")
inDirHF  <- if(noCons){"Data/noCons/singleClub/"} else {"Data/withCons/singleClub/"}
source('~/Documents/MCStudy10000/mcHF.R', echo=TRUE)
inDirHF  <- if(noCons){"Data/noCons/singleClub/"} else {"Data/withCons/singleClub/"}
type
nchar("DSM")
setwd("~/Documents/MCCorradoExt/")
n <- 10;clsize=3;Tm=100;frho=.2;noCOns=T
library("rugarch")
hitRat <- function(maxScc,exc,clsize,n){
UU <- maxScc; DU <- clsize-maxScc ; UD <- exc; DD <- n-clsize-exc
hitR   <- (UU+DD)/(UU+DD+UD+DU)
H      <- (UU)/(UU+DU)
F      <- (UD)/(UD+DD)
KS     <- H-F
return(list(hitR,H,F,KS))
}
PTestHF<- function(dat){
gmms    <- dat[1,]; dat<-dat[-1,]
indlstA <- seq(1,nrow(dat),2); lstA <- dat[indlstA,]
indlstR <- seq(2,nrow(dat),2); lstR <- dat[indlstR,]
actua  <- (gmms==1)*1-(gmms!=1)*1
forecA <- matrix(1,nrow(lstA),ncol(lstA)); forecA[lstA!="c"]<- -1
forecR <- matrix(1,nrow(lstR),ncol(lstR)); forecR[lstR!="c"]<- -1
actua  <- rep(actua,nrow(dat)/2)
dacA   <- DACTest(c(t(forecA)),actua,"PT",.05)$Stat / sqrt(nrow(forecA))
dacR   <- DACTest(c(t(forecR)),actua,"PT",.05)$Stat / sqrt(nrow(forecR))
dac    <- c(dacA,dacR)
return(dac)
}
PTestAGK<- function(dat){
gmms    <- dat[1,]
dat     <- dat[-1,]
ind.01  <- grepl("adf-0.01",rownames(dat))
ind.05  <- grepl("adf-0.05",rownames(dat))
ind.1   <- grepl("adf-0.10",rownames(dat))
lists <- list()
lists <- list(dat[ind.01,],dat[ind.05,],dat[ind.1,])
actua <- (gmms==1)*1-(gmms!=1)*1
forec <- lapply(lists, function(l) matrix(1,nrow(l),ncol(l)))
for(i in 1:length(lists)){forec[[i]][which(lists[[i]]=="")]<- -1}
actuaVecs <- lapply(forec, function(f) rep(actua,nrow(f)))
forecVecs <- lapply(1:3, function(i) c(t(forec[[i]])))
ptRess <- sapply(1:3, function(x) DACTest(forecVecs[[x]],actuaVecs[[x]],"PT",.05)$Stat/sqrt(nrow(forec[[x]])))
return(ptRess)
}
anlysofoutptAGK<- function(Tm,n,clsize,noCons){
nocStr   <- if(noCons){"-noCons"} else {"-withCons"}
dirName  <- if(noCons){"Output/noCons/singleClub/"} else {"Output/withCons/singleClub/"}
calcRep<-list()
for(frho in c(2,6)){calcRep[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,"-AGK",nocStr,"/reportAGK-",Tm,"-",frho/10,".rda")))}
gmml<-list()
for(frho in c(2,6)){gmml[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,"-AGK",nocStr,"/gmmlAGK-",Tm,"-",frho/10,".rda")))}
gmmlCW <- list()
for(frho in c(2,6)){gmmlCW[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,nocStr,"_CW/gmmlCW-",Tm,"-",frho/10,".rda")))}
nT     <- sum(!duplicated(rownames(calcRep[[2]])))
trials <- nrow(calcRep[[2]])/nT
TTm    <- trials*nT
anlysOutp <- function(calcRep,clsize,frho,gmml){
ind <- frho*10
errorind <- apply(gmmlCW[[ind]]=="",1,sum)==n
errorind <- matrix(errorind[-1],,2,byrow = T)[,1]
indadf.01  <- grepl("adf-0.01",rownames(calcRep[[ind]])) & !errorind
indadf.05  <- grepl("adf-0.05",rownames(calcRep[[ind]])) & !errorind
indadf.1   <- grepl("adf-0.1",rownames(calcRep[[ind]])) & !errorind
adf.01  <- c(apply(calcRep[[ind]][indadf.01,],2,sum),nrow(calcRep[[ind]][indadf.01,]))
adf.05  <- c(apply(calcRep[[ind]][indadf.05,],2,sum),nrow(calcRep[[ind]][indadf.05,]))
adf.1   <- c(apply(calcRep[[ind]][indadf.1,],2,sum),nrow(calcRep[[ind]][indadf.1,]))
adf.01prf  <- sum(calcRep[[ind]][indadf.01,1]==clsize & calcRep[[ind]][indadf.01,2]==0)
adf.05prf  <- sum(calcRep[[ind]][indadf.05,1]==clsize & calcRep[[ind]][indadf.05,2]==0)
adf.1prf   <- sum(calcRep[[ind]][indadf.1,1]==clsize & calcRep[[ind]][indadf.1,2]==0)
prfs  <- c(adf.01prf,adf.05prf,adf.1prf)
repss <- cbind(adf.01,adf.05,adf.1)
prfs  <- prfs / repss[3,]
hitReps <- sapply(1:3, function(x) hitRat(repss[1,x],repss[2,x],clsize*repss[3,x],n*repss[3,x]))
rownames(hitReps) <- c("HitR", "H", "F", "KS")
anlysPT <- PTestAGK(gmml[[ind]][c(T,!errorind),])
rep     <- rbind(hitReps,anlysPT,prfs)
return(rep)
}
tempRep <- lapply(c(2,6)/10, function(frho) anlysOutp(calcRep,clsize,frho,gmml))
reps    <- lapply(1:6, function(x) rbind(tempRep[[1]][x,],tempRep[[2]][x,]))
return(reps)
}
anlysofoutptHF <- function(Tm,n,clsize,noCons){
nocStr   <- if(noCons){"-noCons"} else {"-withCons"}
dirName  <- if(noCons){"Output/noCons/singleClub/"} else {"Output/withCons/singleClub/"}
calcRep<-list()
for(frho in c(2,6)){calcRep[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,nocStr,"_HF/reportHF-",Tm,"-",frho/10,".rda")))}
gmml<-list()
for(frho in c(2,6)){gmml[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,nocStr,"_HF/gmmlHF-",Tm,"-",frho/10,".rda")))}
gmmlCW<-list()
for(frho in c(2,6)){gmmlCW[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,nocStr,"_CW/gmmlCW-",Tm,"-",frho/10,".rda")))}
nT     <- sum(!duplicated(rownames(calcRep[[2]])))
trials <- nrow(calcRep[[2]])/nT
TTm    <- trials*nT
anlysOutp <- function(calcRep,clsize,frho,gmml){
ind <- frho*10
errorind <- apply(gmmlCW[[ind]]=="",1,sum)==n
calcRepA <- calcRep[[ind]][!matrix(errorind[-1],,2,byrow = T)[,1],c(1,2)]
calcRepR <- calcRep[[ind]][!matrix(errorind[-1],,2,byrow = T)[,1],c(3,4)]
HFA.01   <- calcRepA[rownames(calcRepA) == "crit01",]; HFR.01   <- calcRepR[rownames(calcRepR) == "crit01",]
HFA.05   <- calcRepA[rownames(calcRepA) == "crit05",]; HFR.05   <- calcRepR[rownames(calcRepR) == "crit05",]
HFA.1    <- calcRepA[rownames(calcRepA) == "crit1", ]; HFR.1    <- calcRepR[rownames(calcRepR) == "crit1", ]
hitRatA  <- sapply(list(HFA.01,HFA.05,HFA.1), function(d) c(apply(d,2,sum),nrow(d)))
hitRatR  <- sapply(list(HFR.01,HFR.05,HFR.1), function(d) c(apply(d,2,sum),nrow(d)))
perfA    <- sapply(list(HFA.01,HFA.05,HFA.1), function(d) sum(d[,1]==clsize & d[,2]==0 ))
perfR    <- sapply(list(HFR.01,HFR.05,HFR.1), function(d) sum(d[,1]==clsize & d[,2]==0 ))
perfA    <- perfA / hitRatA[3,]
perfR    <- perfR / hitRatR[3,]
repA <- apply(hitRatA, 2, function(hr) simplify2array(hitRat(hr[1],hr[2],clsize*hr[3],n*hr[3])))
repR <- apply(hitRatR, 2, function(hr) simplify2array(hitRat(hr[1],hr[2],clsize*hr[3],n*hr[3])))
gmmls   <- lapply(c("01","05","1"), function(crit) gmml[[ind]][!errorind & (rownames(gmml[[ind]]) %in% c("gammas",paste0(c("abs","rel"), crit))), ])
ptestAR <- sapply(gmmls, PTestHF)
rownames(repA) <- rownames(repR) <- c("HitRat","H","F","KS")
repA <- rbind(repA,ptestAR[1,],perfA)
repR <- rbind(repR,ptestAR[2,],perfR)
anlys <- cbind(repA,repR)
colnames(anlys) <- unlist(lapply(c("A","R"), function(l) paste0(l,c(".01",".05",".1"))))
return(anlys)
}
tempRepp <- lapply((c(2,6))/10, function(d) anlysOutp(calcRep,clsize,d,gmml))
reps     <- lapply(1:6, function(x) rbind(tempRepp[[1]][x,],tempRepp[[2]][x,]))
return(reps)
}
anlysofoutptCW <- function(Tm,n,clsize,noCons){
nocStr   <- if(noCons){"-noCons"} else {"-withCons"}
dirName  <- if(noCons){"Output/noCons/singleClub/"} else {"Output/withCons/singleClub/"}
calcRep<-list()
for(frho in c(2,6)){calcRep[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,nocStr,"_CW/reportCW-",Tm,"-",frho/10,".rda")))}
gmml<-list()
for(frho in c(2,6)){gmml[[frho]]<- get(load(paste0(dirName,"Results_",n,"-",clsize,nocStr,"_CW/gmmlCW-",Tm,"-",frho/10,".rda")))}
nT     <- sum(!duplicated(rownames(calcRep[[2]])))
trials <- nrow(calcRep[[2]])/nT
TTm    <- trials*nT
anlysOutp <- function(calcRep,clsize,frho,gmml){
ind <- frho*10
# errorind <- which(apply(gmml[grepl("abs",rownames(gmml)),]=="",1,sum)==n)
errorind <- apply(gmml[[ind]]=="",1,sum)==n
calcRepA <- calcRep[[ind]][!matrix(errorind[-1],,2,byrow = T)[,1],c(1,2)]
calcRepR <- calcRep[[ind]][!matrix(errorind[-1],,2,byrow = T)[,1],c(3,4)]
CWA.01   <- calcRepA[rownames(calcRepA) == "crit01",]; CWR.01   <- calcRepR[rownames(calcRepR) == "crit01",]
CWA.05   <- calcRepA[rownames(calcRepA) == "crit05",]; CWR.05   <- calcRepR[rownames(calcRepR) == "crit05",]
CWA.1    <- calcRepA[rownames(calcRepA) == "crit1", ]; CWR.1    <- calcRepR[rownames(calcRepR) == "crit1", ]
hitRatA  <- sapply(list(CWA.01,CWA.05,CWA.1), function(d) c(apply(d,2,sum),nrow(d)))
hitRatR  <- sapply(list(CWR.01,CWR.05,CWR.1), function(d) c(apply(d,2,sum),nrow(d)))
perfA    <- sapply(list(CWA.01,CWA.05,CWA.1), function(d) sum(d[,1]==clsize & d[,2]==0 ))
perfR    <- sapply(list(CWR.01,CWR.05,CWR.1), function(d) sum(d[,1]==clsize & d[,2]==0 ))
perfA    <- perfA / hitRatA[3,]
perfR    <- perfR / hitRatR[3,]
repA <- apply(hitRatA, 2, function(hr) simplify2array(hitRat(hr[1],hr[2],clsize*hr[3],n*hr[3])))
repR <- apply(hitRatR, 2, function(hr) simplify2array(hitRat(hr[1],hr[2],clsize*hr[3],n*hr[3])))
gmmls   <- lapply(c("01","05","1"), function(crit) gmml[[ind]][!errorind & (rownames(gmml[[ind]]) %in% c("gammas",paste0(c("abs","rel"), crit))), ])
ptestAR <- sapply(gmmls, PTestHF)
rownames(repA) <- rownames(repR) <- c("HitRat","H","F","KS")
repA <- rbind(repA,ptestAR[1,],perfA)
repR <- rbind(repR,ptestAR[2,],perfR)
anlys <- cbind(repA,repR)
colnames(anlys) <- unlist(lapply(c("A","R"), function(l) paste0(l,c(".01",".05",".1"))))
return(anlys)
}
tempRepp <- lapply((c(2,6))/10, function(d) anlysOutp(calcRep,clsize,d,gmml))
reps     <- lapply(1:6, function(x) rbind(tempRepp[[1]][x,],tempRepp[[2]][x,]))
return(reps)
}
overallAnlys <- function(TmVec,n,clsize,noCons) {
nlyAGK   <- lapply(TmVec, function(Tm) anlysofoutptAGK(Tm,n,clsize,noCons))
nlyAGK   <- lapply(1:length(nlyAGK[[1]]), function(x) do.call(rbind,lapply(nlyAGK, function(n) n[[x]])))
nlyHF    <- lapply(TmVec, function(Tm) anlysofoutptHF(Tm,n,clsize,noCons))
nlyHF    <- lapply(1:length(nlyHF[[1]]), function(x)  do.call(rbind,lapply(nlyHF, function(n) n[[x]])))
nlyCW    <- lapply(TmVec, function(Tm) anlysofoutptCW(Tm,n,clsize,noCons))
nlyCW    <- lapply(1:length(nlyCW[[1]]), function(x)  do.call(rbind,lapply(nlyCW, function(n) n[[x]])))
nocstr <- if(noCons){"A"} else {"R"}
ovrNly   <- lapply(1:length(nlyAGK), function(x) cbind(nlyAGK[[x]],nlyHF[[x]][,grepl(nocstr,colnames(nlyHF[[x]]))],nlyCW[[x]][,grepl(nocstr,colnames(nlyCW[[x]]))]))
ovrNly   <- lapply(1:length(nlyAGK), function(x) ovrNly[[x]][order(rep(c(.2,.6),length(TmVec))),])
for(i in 1:length(ovrNly)){colnames(ovrNly[[i]]) <- sapply(c("MCL","HF","CW"), function(m) paste0(m, c(".01",".05",".1")))}
return(ovrNly)
}
overallAnlys(c(50,75,100),10,3,T)
overallAnlys(c(50,75,100),10,3,T)
